function timeSince(e){var s=new Date(e),o=s.getHours().toString(),n=1==o.length?"0"+o:o,i=s.getMinutes().toString(),t=1==i.length?"0"+i:i,r=s.getSeconds().toString(),c=1==r.length?"0"+r:r,a=s.getDate().toString(),l=1==a.length?"0"+a:a,g=(s.getMonth()+1).toString(),d=1==g.length?"0"+g:g,m=s.getFullYear();return`${n}:${t}:${c} ${l}.${d}.${m}`}function notifyMe(e){if("granted"!==Notification.permission)Notification.requestPermission();else{var s=e.icon&&e.icon.length?e.icon:"/images/message-icon.png",o=e.title&&e.title.length?e.title:"Notificação Chat",n=e.body&&e.body.length?e.body.replace(/(<([^>]+)>)/gi,""):"bla bla bla",i=new Notification(o,{icon:s,body:n});i.onclick=function(){window.focus(),this.cancel()}}}function renderMessage(e){var s=decodeURIComponent(e.message.replace(/%0A/gi,"<br />")),o=timeSince(e.date),n='<div class="d-flex justify-content-start mb-4"><div class="img_cont_msg"><img src="'+e.img+'" class="rounded-circle user_img_msg"></div><div class="msg_cotainer">'+s+'<span class="msg_time">'+o+"</span></div></div>",i='<div class="d-flex justify-content-end mb-4"><div class="msg_cotainer_send">'+s+'<span class="msg_time_send">'+o+'</span></div><div class="img_cont_msg"><img src="'+e.img+'" class="rounded-circle user_img_msg"></div></div>';usrMsg=e.cod!=user?n:i,document.getElementById("historyMessage").innerHTML+=usrMsg;var t=document.getElementById("historyMessage");t.scrollTop=t.scrollHeight}function loadUsers(e){var s="";for(const n of e){var o=n.status?"online_icon":"online_icon offline";s+='<li class="active"><div class="d-flex bd-highlight"><div class="img_cont"><img src="'+n.img+'" class="rounded-circle user_img"><span class="'+o+'"></span></div><div class="user_info"><span>'+n.name+"</span><p>"+n.cargo+"</p></div></div></li>"}document.querySelector("#usersRoom").innerHTML=s}function showErro(e){Swal.fire({icon:"error",title:"SISC CHAT",html:e.erro})}function loadMyPicture(e){document.querySelector("#myPicture").innerHTML='<img src="'+e+'" class="rounded-circle user_img" /><span class="online_icon"></span>'}function sendMessage(){var e=document.querySelectorAll("#messageUsr")[0].value,s=encodeURIComponent(e.replace(/(<([^>]+)>)/gi,""));if(user.length&&s.length>1){var o={cod:user,message:s,room:room,ip:ipUsr};socket.emit("sendMessage",o)}document.querySelectorAll("#messageUsr")[0].value=""}const socket=io(),messageUsr=document.querySelectorAll(".type_msg")[0];window.onload=function(){let e="/sounds/beep.mp3",s=new Audio(e);socket.on("sendMessage",function(e){if(!document.hasFocus()){var o=decodeURIComponent(e.message.replace(/%0A/gi,"<br />"));e.cod!=user&&notifyMe({icon:e.img,title:"Mensagem recebida",body:o}),s.play()}renderMessage(e)}),socket.on("erro",function(e){showErro(e)}),socket.on("loadMyPicture",function(e){loadMyPicture(e.img)}),socket.on("loadUsersRoom",function(e){loadUsers(e)}),socket.on("previousMessage",function(e){for(message of e)renderMessage(message)}),console.log(user),"string"==typeof user&&1<user.length?(socket.emit("create",{room:room,user:user,ip:ipUsr}),socket.emit("login",{user:user})):(console.log(user),this.showErro({erro:"Informações incorretas!"})),messageUsr.addEventListener("keyup",function(e){13==e.keyCode&&0==e.shiftKey&&sendMessage()})};