function timeSince(e){var o=new Date(e),s=o.getHours().toString(),i=1==s.length?"0"+s:s,n=o.getMinutes().toString(),t=1==n.length?"0"+n:n,r=o.getSeconds().toString(),a=1==r.length?"0"+r:r,c=o.getDate().toString(),l=1==c.length?"0"+c:c,d=(o.getMonth()+1).toString(),u=1==d.length?"0"+d:d,g=o.getFullYear();return`${i}:${t}:${a} ${l}/${u}/${g}`}function notifyMe(e){if("granted"!==Notification.permission)Notification.requestPermission();else{var o=e.icon&&e.icon.length?e.icon:"/images/message-icon.png",s=e.title&&e.title.length?e.title:"Notificação Chat",i=e.body&&e.body.length?e.body.replace(/(<([^>]+)>)/gi,""):"bla bla bla",n=new Notification(s,{icon:o,body:i});n.onclick=function(){window.focus(),this.cancel()}}}function renderMessage(e){var o=decodeURIComponent(e.message.replace(/%0A/gi,"<br />")),s=timeSince(e.date),i='<div class="d-flex justify-content-start mb-4"><div class="img_cont_msg"><img src="'+e.img+'" class="rounded-circle user_img_msg"></div><div class="msg_cotainer">'+o+'<span class="msg_time">'+s+"</span></div></div>",n='<div class="d-flex justify-content-end mb-4"><div class="msg_cotainer_send">'+o+'<span class="msg_time_send">'+s+'</span></div><div class="img_cont_msg"><img src="'+e.img+'" class="rounded-circle user_img_msg"></div></div>';usrMsg=e.cod!=user?i:n,document.getElementById("historyMessage").innerHTML+=usrMsg;var t=document.getElementById("historyMessage");t.scrollTop=t.scrollHeight}function loadUsers(e){var o="";for(const i of e){var s=i.status?'<span class="online_icon" title="online"></span>':'<span class="online_icon offline" title="off-line"></span>';o+='<li class="row"><div class="img_cont"><img src="'+i.img+'" class="rounded-circle user_img">'+s+'</div><div class="user_info"><span>'+i.name+"</span><p>"+i.cargo+"</p></div></li>"}document.querySelector("#usersRoom").innerHTML=o}function showErro(e){Swal.fire({icon:"error",title:"SISC CHAT",html:e.erro})}function loadMyPicture(e){document.querySelector("#myPicture").innerHTML='<img src="'+e+'" class="rounded-circle user_img" /><span class="online_icon"></span>'}function sendMessage(){var e=document.querySelectorAll("#messageUsr")[0].value,o=encodeURIComponent(e.replace(/(<([^>]+)>)/gi,""));if(user.length&&o.length>1){var s={cod:user,message:o,room:room,ip:ipUsr};socket.emit("sendMessage",s)}document.querySelectorAll("#messageUsr")[0].value=""}function dropzoneExists(e){var o=$(e).find(".dz-default");return o.length>0}async function selectTipoArquivoEnviar(e){console.log(e),dropzoneExists(".dropzone")||null==e||($(".dropzone").dropzone(configDropZone),$(".fallback").removeClass("d-none"))}const dropzone_config={dictDefaultMessage:"Clique para selecionar o arquivo",dictFallbackMessage:"Seu navegador não suporta arrastar o arquivo.",dictFallbackText:"Por favor, use o formulário de fallback abaixo para fazer upload de seus arquivos, como nos velhos tempos.",dictFileTooBig:"Arquivo é muito grande ({{filesize}}MiB). Tamanho maximo: {{maxFilesize}}MiB.",dictInvalidFileType:"Você não pode fazer upload de arquivos deste tipo.",dictResponseError:"Servidor respondeu com {{statusCode}} codigo.",dictCancelUpload:"Cancelar upload",dictCancelUploadConfirmation:"Tem certeza de que deseja cancelar este upload?",dictRemoveFile:"Remover arquivo",dictMaxFilesExceeded:"Você não pode enviar mais arquivo."};Dropzone.autoDiscover=!1;const socket=io(),messageUsr=document.querySelectorAll(".type_msg")[0];window.onload=function(){let e="/sounds/beep.mp3",o=new Audio(e);socket.on("sendMessage",function(e){if(!document.hasFocus()){var s=decodeURIComponent(e.message.replace(/%0A/gi,"<br />"));e.cod!=user&&notifyMe({icon:e.img,title:"Mensagem recebida",body:s}),o.play()}renderMessage(e)}),socket.on("erro",function(e){showErro(e)}),socket.on("loadMyPicture",function(e){loadMyPicture(e.img)}),socket.on("loadUsersRoom",function(e){loadUsers(e)}),socket.on("previousMessage",function(e){for(message of e)renderMessage(message)}),"string"==typeof user&&1<user.length?(socket.emit("create",{room:room,user:user,ip:ipUsr}),socket.emit("login",{user:user})):this.showErro({erro:"Informações incorretas!"}),messageUsr.addEventListener("keyup",function(e){13==e.keyCode&&0==e.shiftKey&&sendMessage()})};let config_drop={url:"/file-upload",maxFiles:1,maxFilesize:5500,timeout:6e5,addRemoveLinks:!1,init:function(e){this.on("complete",function(e){$(".modal").modal("hide"),this.removeFile(e)})}},configDropZone={...config_drop,...dropzone_config};